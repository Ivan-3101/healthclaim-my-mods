<form role="form" name="finalReviewForm">
    <!-- UI Displayer Fields -->
    <h3>Extracted Data (Editable)</h3>
    <div ng-repeat="field in $root.finalReviewFields">
        <div class="form-group">
            <label>{{field.label}} ({{field.docType}})</label>
            <input type="text"
                   class="form-control"
                   cam-variable-name="final_{{field.label.toLowerCase().replace(/[^a-z0-9]/g, '_').replace(/_+/g, '_').replace(/^_|_$/g, '')}}"
                   cam-variable-type="String"
                   ng-model="field.value" />
            <small class="text-muted">Fetch Status: {{field.fetchStatus}}</small>
        </div>
    </div>

    <!-- Policy Coherence Output (Read-only) -->
    <hr>
    <h3>Policy Coherence Analysis</h3>
    <div class="form-group">
        <label>Policy Coherence Results</label>
        <textarea class="form-control"
                  rows="10"
                  ng-model="$root.policyCoherenceOutput"
                  readonly></textarea>
    </div>

    <!-- Medical Coherence Output (Read-only) -->
    <hr>
    <h3>Medical Coherence Analysis</h3>
    <div class="form-group">
        <label>Medical Coherence Results</label>
        <textarea class="form-control"
                  rows="10"
                  ng-model="$root.medicalCoherenceOutput"
                  readonly></textarea>
    </div>

    <!-- Action -->
    <hr>
    <div class="form-group">
        <label>Final Action</label>
        <select class="form-control"
                cam-variable-name="FinalAction"
                cam-variable-type="String"
                required>
            <option value="approve">Approve</option>
            <option value="reject">Reject</option>
        </select>
    </div>
</form>

<script cam-script type="text/form-script">
    camForm.on('form-loaded', function() {
        camForm.variableManager.fetchVariable('finalReviewFields');
        camForm.variableManager.fetchVariable('policyCoherenceOutput');
        camForm.variableManager.fetchVariable('medicalCoherenceOutput');
    });

    camForm.on('variables-fetched', function() {
        $scope.$root.finalReviewFields = camForm.variableManager.variableValue('finalReviewFields')
            ? JSON.parse(camForm.variableManager.variableValue('finalReviewFields'))
            : [];
        $scope.$root.policyCoherenceOutput = camForm.variableManager.variableValue('policyCoherenceOutput') || '{}';
        $scope.$root.medicalCoherenceOutput = camForm.variableManager.variableValue('medicalCoherenceOutput') || '{}';
    });
</script>