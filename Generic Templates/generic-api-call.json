{
  "$schema": "https://unpkg.com/@camunda/element-templates-json-schema/resources/schema.json",
  "name": "Generic API Call",
  "id": "com.dronapay.generic.apicall",
  "appliesTo": [
    "bpmn:ServiceTask"
  ],
  "description": "Makes a generic HTTP call using App Properties and Process Variables. Supports unified output mapping (Patterns A/B/C/D) identical to Generic Agent Task.",
  "properties": [
    {
      "type": "Hidden",
      "value": "com.DronaPay.generic.delegates.GenericApiCallDelegate",
      "binding": {
        "type": "property",
        "name": "camunda:class"
      }
    },
    {
      "label": "Base URL",
      "description": "Select the API base URL",
      "type": "Dropdown",
      "choices": [
        { "name": "Spring API", "value": "springapi" }
      ],
      "value": "springapi",
      "binding": {
        "type": "camunda:field",
        "name": "baseUrl"
      }
    },
    {
      "label": "Route",
      "description": "API route. Supports process variables. e.g. /accounts/${processVariable.policy_id}",
      "type": "String",
      "binding": {
        "type": "camunda:field",
        "name": "route"
      },
      "constraints": {
        "notEmpty": true
      }
    },
    {
      "label": "Authentication",
      "description": "Select authentication method",
      "type": "Dropdown",
      "choices": [
        { "name": "X-API-Key", "value": "xApiKey" }
      ],
      "value": "xApiKey",
      "binding": {
        "type": "camunda:field",
        "name": "authType"
      }
    },
    {
      "label": "Method",
      "type": "Dropdown",
      "choices": [
        { "name": "GET",    "value": "GET"    },
        { "name": "POST",   "value": "POST"   },
        { "name": "PUT",    "value": "PUT"    },
        { "name": "DELETE", "value": "DELETE" }
      ],
      "value": "GET",
      "binding": {
        "type": "camunda:field",
        "name": "method"
      }
    },
    {
      "label": "Request Body",
      "description": "JSON body for POST/PUT. Enter NA for GET requests or when using MinIO Body Path below.",
      "type": "Text",
      "value": "NA",
      "binding": {
        "type": "camunda:field",
        "name": "body"
      }
    },
    {
      "label": "MinIO Body Path",
      "description": "Process variable holding the MinIO path of a JSON file to use as request body (e.g. ${attribsMinioPath}). Overrides Request Body above. Enter NA to skip.",
      "type": "String",
      "value": "NA",
      "binding": {
        "type": "camunda:field",
        "name": "minioBodyPath"
      }
    },
    {
      "label": "MinIO Body JsonPath",
      "description": "JsonPath to extract from the MinIO file. Use $ for the entire file, or a specific path e.g. $.attribs.hni",
      "type": "String",
      "value": "$",
      "binding": {
        "type": "camunda:field",
        "name": "minioBodyJsonPath"
      }
    },
    {
      "label": "Output Variable Name",
      "description": "Name of the process variable to store the full JSON response. Also derives {name}_minioPath which is always auto-populated with the MinIO storage path.",
      "type": "String",
      "value": "apiResponse",
      "binding": {
        "type": "camunda:field",
        "name": "outputVar"
      }
    },
    {
      "label": "Output Mapping (JSON)",
      "description": "Unified output config. Each key is the output name. Supports 4 patterns:\n\nPATTERN A — single path → process variable:\n{\"myVar\": {\"storeIn\": \"processVariable\", \"dataType\": \"string\", \"path\": \"$.verified\"}}\n\nPATTERN B — single path → MinIO file:\n{\"myFile\": {\"storeIn\": \"objectStorage\", \"path\": \"$.attribs\", \"targetPath\": \"1/${workflowKey}/${TicketID}/stage/attribs.json\", \"targetVarName\": \"attribsMinioPath\"}}\n\nPATTERN C — merge multiple sources → process variable:\n{\"summary\": {\"storeIn\": \"processVariable\", \"mergeVariables\": true, \"mergePaths\": [{\"keyName\": \"holderName\", \"sourceType\": \"responseJson\", \"path\": \"$.accountName\"}, {\"keyName\": \"risk\", \"sourceType\": \"processVariable\", \"variableName\": \"RiskScore\"}, {\"keyName\": \"doc\", \"sourceType\": \"minioFile\", \"sourcePath\": \"1/${workflowKey}/${TicketID}/stage/doc.json\", \"path\": \"$\"}]}}\n\nPATTERN D — merge multiple sources → MinIO file:\n{\"report\": {\"storeIn\": \"objectStorage\", \"mergeVariables\": true, \"targetPath\": \"1/${workflowKey}/${TicketID}/stage/report.json\", \"targetVarName\": \"reportMinioPath\", \"mergePaths\": [...]}}\n\nEnter {} to skip.",
      "type": "Text",
      "value": "{}",
      "binding": {
        "type": "camunda:field",
        "name": "outputMapping"
      }
    }
  ]
}