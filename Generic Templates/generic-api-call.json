{
  "$schema": "https://unpkg.com/@camunda/element-templates-json-schema/resources/schema.json",
  "name": "Generic API Call",
  "id": "com.dronapay.generic.apicall",
  "appliesTo": [
    "bpmn:ServiceTask"
  ],
  "description": "Makes a generic HTTP call using App Properties and Process Variables",
  "properties": [
    {
      "type": "Hidden",
      "value": "com.DronaPay.generic.delegates.GenericApiCallDelegate",
      "binding": {
        "type": "property",
        "name": "camunda:class"
      }
    },
    {
      "label": "Base URL",
      "description": "Select the API base URL",
      "type": "Dropdown",
      "choices": [
        { "name": "Spring API", "value": "springapi" }
      ],
      "value": "springapi",
      "binding": {
        "type": "camunda:field",
        "name": "baseUrl"
      }
    },
    {
      "label": "Route",
      "description": "API route. Supports process variables. e.g. /accounts/${processVariable.policy_id}",
      "type": "String",
      "binding": {
        "type": "camunda:field",
        "name": "route"
      },
      "constraints": {
        "notEmpty": true
      }
    },
    {
      "label": "Authentication",
      "description": "Select authentication method",
      "type": "Dropdown",
      "choices": [
        { "name": "X-API-Key", "value": "xApiKey" }
      ],
      "value": "xApiKey",
      "binding": {
        "type": "camunda:field",
        "name": "authType"
      }
    },
    {
      "label": "Method",
      "type": "Dropdown",
      "choices": [
        { "name": "GET", "value": "GET" },
        { "name": "POST", "value": "POST" },
        { "name": "PUT", "value": "PUT" },
        { "name": "DELETE", "value": "DELETE" }
      ],
      "value": "GET",
      "binding": {
        "type": "camunda:field",
        "name": "method"
      }
    },
    {
      "label": "Request Body",
      "description": "JSON body for POST/PUT. Enter NA for GET requests or when using MinIO Body Path below.",
      "type": "Text",
      "value": "NA",
      "binding": {
        "type": "camunda:field",
        "name": "body"
      }
    },
    {
      "label": "MinIO Body Path",
      "description": "Process variable holding the MinIO path of a JSON file to use as request body (e.g. ${attribsMinioPath}). Overrides Request Body above. Enter NA to skip.",
      "type": "String",
      "value": "NA",
      "binding": {
        "type": "camunda:field",
        "name": "minioBodyPath"
      }
    },
    {
      "label": "MinIO Body JsonPath",
      "description": "JsonPath to extract from the MinIO file. Use $ for the entire file, or a specific path e.g. $.attribs.hni",
      "type": "String",
      "value": "$",
      "binding": {
        "type": "camunda:field",
        "name": "minioBodyJsonPath"
      }
    },
    {
      "label": "Output Variable Name",
      "description": "Name of the process variable to store the full JSON response. Also derives {name}_minioPath.",
      "type": "String",
      "value": "apiResponse",
      "binding": {
        "type": "camunda:field",
        "name": "outputVar"
      }
    },
    {
      "label": "Output Mapping (JSON)",
      "description": "Extract specific JsonPath values from the response and store as process variables. Example: {\"policyFound\": \"$.verified\", \"holderName\": \"$.accountName\"}. Enter {} to skip.",
      "type": "Text",
      "value": "{}",
      "binding": {
        "type": "camunda:field",
        "name": "outputMapping"
      }
    },
    {
      "label": "MinIO Extract (JSON)",
      "description": "Extract JsonPath values from the response and save each as a new MinIO file. Example: [{\"sourceJsonPath\": \"$.attribs\", \"targetPath\": \"${TicketID}/attribs.json\", \"targetVarName\": \"attribsMinioPath\"}]. Enter [] to skip.",
      "type": "Text",
      "value": "[]",
      "binding": {
        "type": "camunda:field",
        "name": "minioExtract"
      }
    }
  ]
}